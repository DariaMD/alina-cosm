megaMenu();
// mainMegaMenu();
// windowSize();


function megaMenu() {
    var ulMega = document.querySelector('.ulMega');
    var catMega = $('.categMega').length > 0;
    var ulHeight = ulMega.scrollHeight;
    var btn = $('.menuToggle');
    var opened = false;
    var tl = new TimelineMax({
        paused: true
    });
    var tlSpeed = .2;
    var testVar = 0;
    var oldVar = testVar;
    var resizeTimer;
    var btnTl = new TimelineMax({
        paused: true
    });
    var isPlaying = false



    if (testVar == 0 && !catMega) {
        asd(false);
    } else {
        asd('close');
    }

    $(window).on('resize', function (e) {

        clearTimeout(resizeTimer);
        resizeTimer = setTimeout(function () {

            if ($(window).width() <= 767) {
                testVar = 1
            } else {
                testVar = 0
            }

            if (oldVar != testVar) {
                if (testVar == 0 && !catMega) {
                    asd('open');
                } else {
                    asd('close');
                }
                oldVar = testVar
            }

        }, 250);

    });


    function asd(chk) {
        if (!chk) {
            return
        }

        tl = new TimelineMax({
            paused: true
        });

        tl.fromTo('.ulMega  ', tlSpeed, {
                height: 0
            }, {
                height: ulHeight,
                ease: Power4.easeIn
            })
            .staggerFromTo('.ulMega  .dropdown', tlSpeed, {
                x: -50,
                autoAlpha: 0
            }, {
                x: 0,
                autoAlpha: 1
            }, tlSpeed / 10);

        if (chk == 'open') {
            tl.play();
        } else if (chk == 'close') {
            tl.reverse().timeScale(tlSpeed * 6);
        }
    }


    btn.on('click', function (e) {
        e.stopPropagation();

        if (isPlaying == false) {
            isPlaying = true

            btnTl = new TimelineMax({
                paused: true,
                onComplete: test,
                onReverseComplete: test
            });

            btnTl.fromTo('.ulMega  ', tlSpeed , {
                    height: 0
                }, {
                    height: ulHeight,
                    ease: Power2.easeIn
                })
                .staggerFromTo('.ulMega  .dropdown', tlSpeed, {
                    x: -50,
                    autoAlpha: 0
                }, {
                    x: 0,
                    autoAlpha: 1
                }, tlSpeed / 10);

            

            if (opened) {
                btnTl.reverse(0, {
                    onComplete: test
                }).timeScale(tlSpeed * 6);

            } else {
                btnTl.play();
            }

        }



        function test() {
            isPlaying = false
            opened = !opened

        }




    })

    $(window).on('click', function () {
        if (opened && !isPlaying) {
            isPlaying = true
            btnTl.reverse(0).timeScale(tlSpeed * 6);
        }

    })

};


// fixed menu

var ctrl = new ScrollMagic.Controller();

var testHeight = $('#cont-fixed-menu').height();

var fixedMenu = new ScrollMagic.Scene({
        triggerElement: '#cont-fixed-menu',
        triggerHook: 1,
        offset: 800,
        duration: testHeight - 800
    }).setClassToggle('.left-menu-fixed', 'show')
    .addTo(ctrl);



counterStart(ctrl);





function counterStart(ctrl) {
    var testEl = $('.green-num')

    if (testEl.length <= 0) {
        return false
    }


    var options = {  
        useEasing: true,
          useGrouping: true,
          separator: ' ',
          decimal: '',
          prefix: '',
          suffix: ''
    };

    var demoArr = [];

    $.each($('.green-num'), function (i, el) {
        var num = $(el).attr('data-num');
        demoArr[i] = {
            el: el,
            num: num
        };
    });

    var demo1 = new CountUp(demoArr[0].el, 0, demoArr[0].num, 0, 5, options);
    var demo2 = new CountUp(demoArr[1].el, 0, demoArr[1].num, 0, 5, options);
    var demo3 = new CountUp(demoArr[2].el, 0, demoArr[2].num, 0, 5, options);
    var demo4 = new CountUp(demoArr[3].el, 0, demoArr[3].num, 0, 5, options);

    var counterStart = new ScrollMagic.Scene({
            triggerElement: '#about',
            triggerHook: 1
        }).on('enter', function () {
            demo1.start();
            demo2.start();
            demo3.start();
            demo4.start();
        })
        .addTo(ctrl)

};
createPrlx();
myScripts();
mainSwiper();

// Sumoselect
if ($('.orderby').length > 0) {
    $(document).ready(function () {
        $('.orderby').SumoSelect({
            placeholder: 'Сортировка по ...',
            selectAll: false
        });
    });
}

function myScripts() {
  var phoneSwiper = new Swiper('#quick-slide', {
          nextButton: '#quick-slide .swiper-button-next',
          prevButton: '#quick-slide .swiper-button-prev',
          spaceBetween: 0
      });


  var productSwiper = new Swiper('.swiper-container.slide-products', {
          nextButton: '.arrow-product-next',
          prevButton: '.arrow-product-prev',
          slidesPerView: 4,
          paginationClickable: true,
          spaceBetween: 30,
          loop: true,
          breakpoints: {
              1200: {
                  slidesPerView: 4,
                  spaceBetween: 20
              },
              1000: {
                  slidesPerView: 3,
                  spaceBetween: 20
              },
              767: {
                  slidesPerView: 2,
                  spaceBetween: 10
              },
              430: {
                  slidesPerView: 1,
                  spaceBetween: 20
              }
          }
      });



  var partnerSwiper = new Swiper('.slider-partners .swiper-container', {
          nextButton: '.slider-partners .arrow-partners-next',
          prevButton: '.slider-partners .arrow-partners-prev',
          slidesPerView: 6,
          spaceBetween: 30,
          loop: true,
          speed: 1000,
          autoplay: 4000,
          breakpoints: {
              1200: {
                  slidesPerView: 5,
                  spaceBetween: 30
              },
              967: {
                  slidesPerView: 4,
                  spaceBetween: 20
              },
              767: {
                  slidesPerView: 3,
                  spaceBetween: 20
              },
              650: {
                  slidesPerView: 2,
                  spaceBetween: 10
              },
              500: {
                  slidesPerView: 1,
                  spaceBetween: 10
              }
          }
      });


      if ( $('#switcher').length > 0 ) {
        var newSwitch = new WsSwitcher({
          levels: ['#switcher .level1', '#switcher .level2', '#switcher .level3'],
          subLevel: '.sublevel',
          slideTo: 'left'
        })
      }


}


function mainSwiper(){

  if ($('#iview').length > 0) {
    var mainSwiper = new Swiper('#iview.swiper-container', {
        paginationClickable: true,
        nextButton: '#iview .swiper-button-next',
        prevButton: '#iview .swiper-button-prev',
        spaceBetween: 0,
        effect: 'fade',
        speed: 1000,
        autoplay: 5000,
        loop: true
    });

    mainSwiper.on('SlideChangeEnd', function(){
        $('#iview .info-box').css({
            opacity: 1,
            transform: 'translateY(0)'
        })
    });
  }

}


// Product add in cart message

function showProductMessage(elm){
    var addProductEl = $(elm).closest('.product-block-sales').find('.added-product');

    addProductEl.addClass('show-product');

    setTimeout(function(){
        addProductEl.removeClass('show-product')
    }, 2000)
}

// range slider
if ($('#range-slider').length > 0) {

  $('#range-slider').slider({
    range: true,
    values: [300, 700],
    min: 10,
    max: 1000,
    animate: 'fast',
    step: 1,
    slide: function(e, u) {
      var val = $('#range-slider').slider('option', 'values');
      $('#price-min').val(val[0]);
      $('#price-max').val(val[1]);
    }
  });
    $( function() {
        $( "#range-slider" ).slider();
    } );
}

$('#product-list').on('click', function(){


  $('.product-block-sales').fadeOut(0, function(){
      $('.product-block-sales').addClass('new-list');
      $('#product-block').removeClass('new-active');
      $('#product-list').addClass('new-active');
  }).fadeIn(500)
})
$('#product-block').on('click', function(){


  $('.product-block-sales').fadeOut(0, function(){
      $('.product-block-sales').removeClass('new-list');
      $('#product-list').removeClass('new-active');
      $('#product-block').addClass('new-active');
  }).fadeIn(500)
})


function openSideNav() {
  if ($('#sidenav').length > 0){
    if( $('#sidenav').hasClass('open') ) {

      sidenav.style.transform = "translateX(-100%)";
      document.body.style.overflowY = "auto";
      $('.btn-filter1').removeClass('ic-hidden');
      $('.btn-filter2').addClass("ic-hidden");
      $('#sidenav').removeClass('open');


    } else {
      sidenav.style.transform = "translateX(0)";
      document.body.style.overflowY = "hidden";
      $('.btn-filter2').removeClass('ic-hidden');
      $('.btn-filter1').addClass("ic-hidden");
      $('#sidenav').addClass('open');
    }
  }
}


// BUTTON FOR INPUT

$(document).ready(function() {
    $('.minus').click(function () {
        var $input = $(this).parent().find('input');
        var count = parseInt($input.val()) - 1;
        count = count < 1 ? 1 : count;
        $input.val(count);
        $input.change();
        return false;
    });
    $('.plus').click(function () {
        var $input = $(this).parent().find('input');
        $input.val(parseInt($input.val()) + 1);
        $input.change();
        return false;
    });
});



// Preloader

function showPreloader(){
    $('.preloader-cont').css({"visibility": "visible", "opacity" : "1", "transition": "ease, .4s"} )
}
function hidePreloader(){
    $('.preloader-cont').css({"visibility": "hidden", "opacity" : "0", "transition": "ease, .4s"} )
}

//mainSwiper.on('SlideChangeEnd', function(){
//    console.log('end')
//    $('#iview .square').css({
//        opacity: 1,
//        transform: 'translateY(0)'
//    })
//})

//mainSwiper.on('SlideChangeStart', function(){
//    console.log('end')
//    $('#iview .info-box').css({
//        opacity: 1,
//        transform: 'translateY(0)'
//    })
//})

// Gallery
if ($('.gallery').length > 0) {
    $(function () {
        var $gallery = $('.gallery a').simpleLightbox();

        $gallery.on('show.simplelightbox', function () {
            // console.log('Requested for showing');
        })
            .on('shown.simplelightbox', function () {
                // console.log('Shown');
            })
            .on('close.simplelightbox', function () {
                // console.log('Requested for closing');
            })
            .on('closed.simplelightbox', function () {
                // console.log('Closed');
            })
            .on('change.simplelightbox', function () {
                // console.log('Requested for change');
            })
            .on('next.simplelightbox', function () {
                // console.log('Requested for next');
            })
            .on('prev.simplelightbox', function () {
                // console.log('Requested for prev');
            })
            .on('nextImageLoaded.simplelightbox', function () {
                // console.log('Next image loaded');
            })
            .on('prevImageLoaded.simplelightbox', function () {
                // console.log('Prev image loaded');
            })
            .on('changed.simplelightbox', function () {
                // console.log('Image changed');
            })
            .on('nextDone.simplelightbox', function () {
                // console.log('Image changed to next');
            })
            .on('prevDone.simplelightbox', function () {
                // console.log('Image changed to prev');
            })
            .on('error.simplelightbox', function (e) {
                // console.log('No image found, go to the next/prev');
                // console.log(e);
            });
    });
}


// Error Msg
showSuccessMsg();
showErrorMsg();
function showSuccessMsg() {
    $('.btn-notification').on('click', function(){

            $('.notification-success').addClass('showMsg');
        setTimeout(function(){
            $('.notification-success').removeClass('showMsg')
        }, 2000)
    })
};
function showErrorMsg() {
    $('.btn-notification').on('click', function(){

        $('.notification-error').addClass('showMsg');
        setTimeout(function(){
            $('.notification-error').removeClass('showMsg')
        }, 2000)
    })
};
